prestige_global_total_update = {
	every_country = {
		set_variable = {
			var = prestige_total
			value = 0
		}
		set_variable = {
			var = prestige_empire_subject
			value = 0
		}
		set_variable = {
			var = prestige_military_subject
			value = 0
		}
	}
	every_country = {
		limit = {
			is_player_tag = yes
			is_puppet = yes
		}
		prestige_country_achievement_update  = yes
		prestige_country_tech_update = yes
		prestige_country_economy_update = yes
		prestige_country_empire_update = yes
		prestige_country_army_update = yes
		multiply_variable = {
			var = prestige_total
			value = 0.30
		}
	}
	every_country = {
		limit = {
			is_player_tag = yes
			is_puppet = no
		}
		prestige_country_achievement_update  = yes
		prestige_country_tech_update = yes
		prestige_country_economy_update = yes
		prestige_country_empire_update = yes
		prestige_country_army_update = yes
	}
	prestige_global_total_sort = yes
}
prestige_country_achievement_update = {
	add_to_variable = {
		var = prestige_total
		value = prestige_achievement
	}
}
prestige_country_tech_update = {
	set_variable = {
		var = prestige_tech
		value = 0
	}
	set_variable = {
		var = prestige_tech_research
		value = researched_techs^num
	}
	add_to_variable = {
		var = prestige_tech
		value = prestige_tech_research
	}
	add_to_variable = {
		var = prestige_tech
		value = prestige_tech_inventions
	}
	add_to_variable = {
		var = prestige_total
		value = prestige_tech
	}
}
prestige_country_economy_update = {
	set_variable = {
		var = prestige_economy
		value = 0
	}
	set_variable = {
		var = prestige_economy_factories
		value = num_of_factories
	}
	add_to_variable = {
		var = prestige_economy
		value = prestige_economy_factories
	}
	set_variable = {
		var = prestige_economy_exports
		value = resource_exported
	}
	multiply_variable = {
		var = prestige_economy_exports
		value = 0.25
	}
	add_to_variable = {
		var = prestige_economy
		value = prestige_economy_exports
	}
}
prestige_country_empire_update = {
	if = {
		limit = { has_idea = law_country_power_irrelevant }
		set_variable = {
			var = prestige_empire
			value = 5
		}
	}
	else_if = {
		limit = { has_idea = law_country_power_minor }
		set_variable = {
			var = prestige_empire
			value = 10
		}
	}
	else_if = {
		limit = { has_idea = law_country_power_secondary }
		set_variable = {
			var = prestige_empire
			value = 15
		}
	}
	else = {
		set_variable = {
			var = prestige_empire
			value = 25
		}
	}
	set_variable = {
		var = prestige_empire_states
		value = num_owned_controlled_states
	}
	add_to_variable = {
		var = prestige_empire
		value = prestige_empire_states
	}
	if = {
		limit = { is_puppet = yes }
		add_political_power = 5
		OVERLORD = {
			add_to_variable = {
				var = prestige_empire_subject
				value = PREV.prestige_empire
			}
		}
	}
	else = {
		multiply_variable = {
			var = prestige_empire_subject
			value = 0.5
		}
		add_to_variable = {
			var = prestige_empire
			value = prestige_empire_subject
		}
	}
	add_to_variable = {
		var = prestige_total
		value = prestige_empire
	}
}
prestige_country_army_update = {
	set_variable = {
		var = prestige_army
		value = 0
	}
	set_variable = {
		var = prestige_army_battalions
		value = num_battalions
	}
	multiply_variable = {
		var = prestige_army_battalions
		value = 0.5
	}
	add_to_variable = {
		var = prestige_army
		value = prestige_army_battalions
	}
	set_variable = {
		var = prestige_army_ships
		value = num_ships
	}
	multiply_variable = {
		var = prestige_army_ships
		value = 0.25
	}
	add_to_variable = {
		var = prestige_army
		value = prestige_army_ships
	}
	set_variable = {
		var = prestige_army_air
		value = num_deployed_planes
	}
	multiply_variable = {
		var = prestige_army_air
		value = 0.25
	}
	add_to_variable = {
		var = prestige_army
		value = prestige_army_air
	}
	if = {
		limit = { has_idea = law_army_tribal_basic }
		multiply_variable = {
			var = prestige_army
			value = 0.65
		}
	}
	else_if = {
		limit = { has_idea = law_army_tribal_improved }
		multiply_variable = {
			var = prestige_army
			value = 0.80
		}
	}
	else_if = {
		limit = { has_idea = law_country_military_traditional }
		multiply_variable = {
			var = prestige_army
			value = 0.925
		}
	}
	else_if = {
		limit = { has_idea = law_country_military_modern }
		multiply_variable = {
			var = prestige_army
			value = 1.15
		}
	}
    # Edit
	if = {
		limit = { is_puppet = yes }
		OVERLORD = {
			add_to_variable = {
				var = prestige_army_subject
				value = PREV.prestige_army
			}
		}
	}
	else = {
		multiply_variable = {
			var = prestige_army_subject
			value = 0.5
		}
		add_to_variable = {
			var = prestige_army
			value = prestige_army_subject
		}
	}
	add_to_variable = {
		var = prestige_total
		value = prestige_army
	}
}
prestige_global_total_sort = {
	clear_array = global.prestige_country_array
	clear_array = global.prestige_country_total_array

	clear_array = global.prestige_country_achievement_array
	clear_array = global.prestige_country_tech_array
	clear_array = global.prestige_country_economy_array
	clear_array = global.prestige_country_empire_array
	clear_array = global.prestige_country_army_array

	every_country = {
		limit = { is_player_tag = yes }
		add_to_array = {
			array = global.prestige_country_array_sorting
			value = THIS.id
		}
		add_to_array = {
			array = global.prestige_country_total_array_sorting
			value = THIS.prestige_total
		}
	}
	set_variable = {
		var = global.prestige_country_rank
		value = 1
	}
	for_loop_effect = {
		if = {
			limit = {
				check_variable = {
					var = global.prestige_country_total_array_sorting^num
					value = 0
				}
			}
			set_temp_variable = { break = 1 }
		}
		find_highest_in_array = {
			array = global.prestige_country_total_array_sorting
			index = index_temp
			add_to_array = {
				array = global.prestige_country_array
				value = global.prestige_country_array_sorting^index_temp
			}
			add_to_array = {
				array = global.prestige_country_total_array
				value = global.prestige_country_total_array_sorting^index_temp
			}
			add_to_array = {
				array = global.prestige_country_achievement_array
				value = global.prestige_country_array_sorting^index_temp:prestige_achievement
			}
			add_to_array = {
				array = global.prestige_country_tech_array
				value = global.prestige_country_array_sorting^index_temp:prestige_tech
			}
			add_to_array = {
				array = global.prestige_country_economy_array
				value = global.prestige_country_array_sorting^index_temp:prestige_economy
			}
			add_to_array = {
				array = global.prestige_country_empire_array
				value = global.prestige_country_array_sorting^index_temp:prestige_empire
			}
			add_to_array = {
				array = global.prestige_country_army_array
				value = global.prestige_country_array_sorting^index_temp:prestige_army
			}
			set_variable = {
				var = global.prestige_country_array_sorting^index_temp:prestige_country_total_rank
				value = global.prestige_country_rank
			}
		}
		add_to_variable = {
			var = global.prestige_country_rank
			value = 1
		}
	}
}

prestige_country_change = {
	add_to_variable = {
		var = prestige_achievement
		value = eoanb_prestige_change
	}
}