# Immigration/Emmigration
	# Culture
		demographics_state_culture_change = {
			# Prep Variables
				# state_culture_temp
				# state_culture_percentage_temp
				set_temp_variable = {
					var = state_culture_percentage_normalizer_temp
					value = 1
				}
				add_to_temp_variable = {
					var = state_culture_percentage_normalizer_temp
					value = state_culture_percentage_temp
				}
			# Add to Arrays
				if = {
					limit = {
						is_in_array = {
							array = state_culture_array
							value = state_culture_temp
						}
					}
					for_each_loop = {
						array = state_culture_array
						index = iterate

						if = {
							limit = {
								check_variable = {
									var = state_culture_array^iterate
									value = state_culture_temp
									compare = equals
								}
							}
							add_to_variable = {
								var = state_culture_percentage_array^iterate
								value = state_culture_percentage_temp
							}
						}
						divide_variable = {
							var = state_culture_percentage_array^iterate
							value = state_culture_percentage_normalizer_temp
						}
					}
				}
				else = {
					add_to_array = {
						array = state_culture_array
						value = state_culture_temp
					}
					add_to_array = {
						array = state_culture_percentage_array
						value = state_culture_percentage_temp
					}
					for_each_loop = {
						array = state_culture_percentage_array
						index = iterate
						divide_variable = {
							var = state_culture_percentage_array^iterate
							value = state_culture_percentage_normalizer_temp
						}
					}
				}
			# Normalize
				set_temp_variable = {
					var = state_culture_percentage_normalizer_temp
					value = 0
				}
				for_each_loop = {
					array = state_culture_percentage_array
					index = iterate

					add_to_temp_variable = {
						var = state_culture_percentage_normalizer_temp
					}		
				}
				if = {
					limit = {
						check_variable = {
							var = state_culture_percentage_normalizer_temp
							value = 1
							compare = greater_than
						}
					}
					subtract_from_temp_variable = {
						var = state_culture_percentage_normalizer_temp
						value = 1
					}
					subtract_from_variable = {
						var = state_culture_percentage_array^num
						value = state_culture_percentage_normalizer_temp
					}
				}
				else_if = {
					limit = {
						check_variable = {
							var = state_culture_percentage_normalizer_temp
							value = 1
							compare = greater_than
						}
					}
					subtract_from_temp_variable = {
						var = state_culture_percentage_normalizer_temp
						value = 1
					}
					subtract_from_variable = {
						var = state_culture_percentage_array^0
						value = state_culture_percentage_normalizer_temp
					}
				}
			# Update
			demographics_state_culture_update = yes
		}
	# Religion
		demographics_state_religion_change = {
			# Prep Variables
				# state_religion_temp
				# state_religion_percentage_temp
				set_temp_variable = {
					var = state_religion_percentage_normalizer_temp
					value = 1
				}
				add_to_temp_variable = {
					var = state_religion_percentage_normalizer_temp
					value = state_religion_percentage_temp
				}
			# Add to Arrays
				if = {
					limit = {
						is_in_array = {
							array = state_religion_array
							value = state_religion_temp
						}
					}
					for_each_loop = {
						array = state_religion_array
						index = iterate

						if = {
							limit = {
								check_variable = {
									var = state_religion_array^iterate
									value = state_religion_temp
									compare = equals
								}
							}
							add_to_variable = {
								var = state_religion_percentage_array^iterate
								value = state_religion_percentage_temp
							}
						}
						divide_variable = {
							var = state_religion_percentage_array^iterate
							value = state_religion_percentage_normalizer_temp
						}
					}
				}
				else = {
					add_to_array = {
						array = state_religion_array
						value = state_religion_temp
					}
					add_to_array = {
						array = state_religion_percentage_array
						value = state_religion_percentage_temp
					}
					for_each_loop = {
						array = state_religion_percentage_array
						index = iterate
						divide_variable = {
							var = state_religion_percentage_array^iterate
							value = state_religion_percentage_normalizer_temp
						}
					}
				}
			# Normalize
				set_temp_variable = {
					var = state_religion_percentage_normalizer_temp
					value = 0
				}
				for_each_loop = {
					array = state_religion_percentage_array
					index = iterate

					add_to_temp_variable = {
						var = state_religion_percentage_normalizer_temp
					}		
				}
				if = {
					limit = {
						check_variable = {
							var = state_religion_percentage_normalizer_temp
							value = 1
							compare = greater_than
						}
					}
					subtract_from_temp_variable = {
						var = state_religion_percentage_normalizer_temp
						value = 1
					}
					subtract_from_variable = {
						var = state_religion_percentage_array^num
						value = state_religion_percentage_normalizer_temp
					}
				}
				else_if = {
					limit = {
						check_variable = {
							var = state_religion_percentage_normalizer_temp
							value = 1
							compare = greater_than
						}
					}
					subtract_from_temp_variable = {
						var = state_religion_percentage_normalizer_temp
						value = 1
					}
					subtract_from_variable = {
						var = state_religion_percentage_array^0
						value = state_religion_percentage_normalizer_temp
					}
				}
			# Update
			demographics_state_religion_update = yes
		}
# Update
	# Culture
		demographics_national_culture_update = {
			every_owned_state = {
				# Update
					demographics_state_culture_update = yes
				# Add
					for_each_loop = {
						array = state_culture_array
						index = iterate
						# Already in Array
							if = {
								limit = {
									is_in_array = {
										array = PREV.national_culture_array_sorting
										value = state_culture_array^iterate
									}
								}
								# Find Index
									for_each_loop = {
										array = PREV.national_culture_array_sorting
										index = iterate2
										if = {
											limit = {
												check_variable = {
													var = PREV.national_culture_array_sorting^iterate2
													value = state_culture_array^iterate
													compare = equals
												}
											}
											set_temp_variable = { 
												var = national_culture_index_temp
												value = iterate2
											}
											set_temp_variable = { break = 1 }
										}
									}
								# Add to Index
									add_to_variable = {
										var = PREV.national_culture_population_sorting^national_culture_index_temp
										value = state_culture_population^iterate
									}
							}
						# Add to Array
							else = {
								add_to_array = {
									array = PREV.national_culture_array_sorting
									value = state_culture_array
								}
								add_to_array = {
									array = PREV.national_culture_population_array_sorting
									value = state_culture_array
								}
							}
					}
			}
			clear_array = national_culture_percentage_array
			for_loop_effect = {
					# Find Highest Population
						find_highest_in_array = {
							array = national_culture_population_array_sorting
							value = national_culture_index_temp
							index = iterate
						}
					# Transfer
						add_to_array = {
							array = national_culture_array
							value = national_culture_array_sorting^iterate
						}
						add_to_array = {
							array = national_culture_population_array
							value = national_culture_population_array_sorting^iterate
						}
						set_temp_variable = {
							var = national_culture_percentage_temp
							value = national_culture_population_array_sorting^iterate
						}
						divide_temp_variable = {
							var = national_culture_percentage_temp
							value = max_manpower_k
						}
						add_to_array = {
							array = national_culture_percentage_array
							value = national_culture_percentage_temp
						}
					# Clean
						remove_from_array = {
							array = national_culture_array_sorted
							index = iterate
						}
						remove_from_array = {
							array = national_culture_population_sorted
							index = iterate
						}
				}
		}
		demographics_state_culture_update = {
			# Sort
				for_loop_effect = {
					# Find Highest Percentage
						find_highest_in_array = {
							array = state_culture_array_percentage
							index = iterate
						}
					# Transfer
						add_to_array = {
							array = state_culture_array_sorted
							value = state_culture_array^iterate
						}
						add_to_array = {
							array = state_culture_percentage_array_sorted
							value = state_culture_percentage_array^iterate
						}
					# Clean 
						remove_from_array = {
							array = state_culture_array
							index = iterate
						}
						remove_from_array = {
							array = state_culture_percentage_array
							index = iterate
						}
				}
				clear_array = state_culture_population_array

			# Transfer
				for_each_loop = {
					array = state_culture_array_sorted
					index = iterate
					# ID
						add_to_array = {
							array = state_culture_array
							value = state_culture_array_sorted^iterate
						}
					# Percentage
						add_to_array = {
							array = state_culture_percentage_array
							value = state_culture_percentage_array_sorted^iterate
						}
					# Population
						set_temp_variable = {
							array = state_culture_population_temp
							value = state_culture_percentage_array_sorted^iterate
						}
						multiply_temp_variable = {
							var = state_culture_population_temp
							value = state_population_k
						}
						add_to_array = {
							array = state_culture_population_array
							value = state_culture_population_temp
						}
				}
			# Clean
				clear_array = state_culture_array_sorted
				clear_array = state_culture_percentage_array_sorted
		}
	# Religion
		demographics_national_religion_update = {
			every_owned_state = {
				# Update
					demographics_state_religion_update = yes
				# Add
					for_each_loop = {
						array = state_religion_array
						index = iterate
						# Already in Array
							if = {
								limit = {
									is_in_array = {
										array = PREV.national_religion_array_sorting
										value = state_religion_array^iterate
									}
								}
								# Find Index
									for_each_loop = {
										array = PREV.national_religion_array_sorting
										index = iterate2
										if = {
											limit = {
												check_variable = {
													var = PREV.national_religion_array_sorting^iterate2
													value = state_religion_array^iterate
													compare = equals
												}
											}
											set_temp_variable = { 
												var = national_religion_index_temp
												value = iterate2
											}
											set_temp_variable = { break = 1 }
										}
									}
								# Add to Index
									add_to_variable = {
										var = PREV.national_religion_population_sorting^national_religion_index_temp
										value = state_religion_population^iterate
									}
							}
						# Add to Array
							else = {
								add_to_array = {
									array = PREV.national_religion_array_sorting
									value = state_religion_array
								}
								add_to_array = {
									array = PREV.national_religion_population_array_sorting
									value = state_religion_array
								}
							}
					}
			}
			clear_array = national_religion_percentage_array
			for_loop_effect = {
					# Find Highest Population
						find_highest_in_array = {
							array = national_religion_population_array_sorting
							value = national_religion_index_temp
							index = iterate
						}
					# Transfer
						add_to_array = {
							array = national_religion_array
							value = national_religion_array_sorting^iterate
						}
						add_to_array = {
							array = national_religion_population_array
							value = national_religion_population_array_sorting^iterate
						}
						set_temp_variable = {
							var = national_religion_percentage_temp
							value = national_religion_population_array_sorting^iterate
						}
						divide_temp_variable = {
							var = national_religion_percentage_temp
							value = max_manpower_k
						}
						add_to_array = {
							array = national_religion_percentage_array
							value = national_religion_percentage_temp
						}
					# Clean
						remove_from_array = {
							array = national_religion_array_sorted
							index = iterate
						}
						remove_from_array = {
							array = national_religion_population_sorted
							index = iterate
						}
				}
		}
		demographics_state_religion_update = {
			# Sort
				for_loop_effect = {
					# Find Highest Percentage
						find_highest_in_array = {
							array = state_religion_array_percentage
							index = iterate
						}
					# Transfer
						add_to_array = {
							array = state_religion_array_sorted
							value = state_religion_array^iterate
						}
						add_to_array = {
							array = state_religion_percentage_array_sorted
							value = state_religion_percentage_array^iterate
						}
					# Clean 
						remove_from_array = {
							array = state_religion_array
							index = iterate
						}
						remove_from_array = {
							array = state_religion_percentage_array
							index = iterate
						}
				}
				clear_array = state_religion_population_array

			# Transfer
				for_each_loop = {
					array = state_religion_array_sorted
					index = iterate
					# ID
						add_to_array = {
							array = state_religion_array
							value = state_religion_array_sorted^iterate
						}
					# Percentage
						add_to_array = {
							array = state_religion_percentage_array
							value = state_religion_percentage_array_sorted^iterate
						}
					# Population
						set_temp_variable = {
							array = state_religion_population_temp
							value = state_religion_percentage_array_sorted^iterate
						}
						multiply_temp_variable = {
							var = state_religion_population_temp
							value = state_population_k
						}
						add_to_array = {
							array = state_religion_population_array
							value = state_religion_population_temp
						}
				}
			# Clean
				clear_array = state_religion_array_sorted
				clear_array = state_religion_percentage_array_sorted
		}
# Setup
	# Culture
		demographics_global_culture_setup = {
			# Germanic
				set_variable = { global.culture_germanic_american = 0 }
				set_variable = { global.culture_germanic_dixie = 1 }
				set_variable = { global.culture_germanic_english = 2 }
				set_variable = { global.culture_germanic_dutch = 3 }
				set_variable = { global.culture_germanic_flemish = 4 }
				set_variable = { global.culture_germanic_afrikaans = 5 }
				set_variable = { global.culture_germanic_danish = 6 }
				set_variable = { global.culture_germanic_swedish = 7 }
			# Romance
				set_variable = { global.culture_romance_brazilian = 8 }
				set_variable = { global.culture_romance_french = 9 }
				set_variable = { global.culture_romance_spanish = 10 }
				set_variable = { global.culture_romance_portugese = 11 }
				set_variable = { global.culture_romance_italian = 12 }
				set_variable = { global.culture_romance_austrian = 13 }
			# Slavic
				set_variable = { global.culture_slavic_russian = 14 }
				set_variable = { global.culture_slavic_montenegrin = 15 }
				set_variable = { global.culture_slavic_serbian = 16 }
				set_variable = { global.culture_slavic_bulgarian = 17 }
			# Albanian
				set_variable = { global.culture_albanian_albanian = 18 }
			# Pontic
				set_variable = { global.culture_pontic_greek = 19 }
				set_variable = { global.culture_pontic_cypriot = 20 }
			# Turkic
				set_variable = { global.culture_turkic_anatolian = 21 }
				set_variable = { global.culture_turkic_azerbaijani = 22 }
				set_variable = { global.culture_turkic_thracian = 23 }
			# Caucasian
				set_variable = { global.culture_caucasian_armenian = 24 }
			# Iranic
				set_variable = { global.culture_iranic_persian = 25 }
				set_variable = { global.culture_iranic_lorish = 26 }
				set_variable = { global.culture_iranic_kurdish = 27 }
				set_variable = { global.culture_iranic_zaza = 28 }
				set_variable = { global.culture_iranic_balouch = 29 }
			# Indo
				set_variable = { global.culture_indo_aryan_nuri = 30 }
				set_variable = { global.culture_indo_aryan_pashfun = 31 }
			# East Semitic
				set_variable = { global.culture_east_semitic_assyrian = 32 }
			# North Semitic
				set_variable = { global.culture_north_semitic_khuzestani = 33 }
				set_variable = { global.culture_north_semitic_mandaean = 34 }
				set_variable = { global.culture_north_semitic_aramic = 35 }
			# Central Semitic
				set_variable = { global.culture_central_semitic_kuwaiti = 36 }
				set_variable = { global.culture_central_semitic_mesopotamian = 37 }
				set_variable = { global.culture_central_semitic_lebanese = 38 }
				set_variable = { global.culture_central_semitic_palestinean = 39 }
				set_variable = { global.culture_central_semitic_hashemite = 40 }
				set_variable = { global.culture_central_semitic_hejazi = 41 }
				set_variable = { global.culture_central_semitic_najdi = 42 }
				set_variable = { global.culture_central_semitic_haasite = 43 }
				set_variable = { global.culture_central_semitic_bahrani = 44 }
				set_variable = { global.culture_central_semitic_shihhi = 45 }
				set_variable = { global.culture_central_semitic_omani = 46 }
				set_variable = { global.culture_central_semitic_sanaan = 47 }
				set_variable = { global.culture_central_semitic_taissi = 48 }
				set_variable = { global.culture_central_semitic_bedawi = 49 }
				set_variable = { global.culture_central_semitic_saidi = 50 }
				set_variable = { global.culture_central_semitic_khartoumese = 51 }
			# West Semitic
				set_variable = { global.culture_west_semitic_tripolitanian = 52 }
				set_variable = { global.culture_west_semitic_tunisian = 53 }
				set_variable = { global.culture_west_semitic_maltese = 54 }
				set_variable = { global.culture_west_semitic_algerian = 55 }
				set_variable = { global.culture_west_semitic_moroccan = 56 }
				set_variable = { global.culture_west_semitic_saharan = 57 }
				set_variable = { global.culture_west_semitic_hassaniya = 58 }
				set_variable = { global.culture_west_semitic_shuwa = 59 }
			# South Semitic
				set_variable = { global.culture_south_semitic_shehri = 60 }
				set_variable = { global.culture_semitic_hadramauti = 61 }
				set_variable = { global.culture_semitic_socotran = 62 }
				set_variable = { global.culture_south_semitic_tigre = 64 }
				set_variable = { global.culture_south_semitic_tigrinya = 65 }
				set_variable = { global.culture_south_semitic_dahalik = 66 }
				set_variable = { global.culture_south_semitic_argobba = 67 }
			# Jewish
				# set_variable = { global.culture_jewish_mizrahi = }
				# set_variable = { global.culture_jewish_beta_israel = }
		}
	# Religion
		demographics_global_religion_setup = {
			# Pagan
				set_variable = { global.religion_animist = 0 }
				set_variable = { global.religion_fetishist = 1 }
			# Ancestorship
				set_variable = { global.religion_mossi = 2 }
				set_variable = { global.religion_ancestorship = 3 }
			# Esoteric Monotheistics
				set_variable = { global.religion_zoroastrian = 4 }
				set_variable = { global.religion_jewish = 5 }
				set_variable = { global.religion_druze = 6 }
				set_variable = { global.religion_waaqism = 7 }
			# Christianity
				set_variable = { global.religion_catholic = 8 }
				set_variable = { global.religion_protestant = 9 }
				set_variable = { global.religion_anglican = 10 }
				set_variable = { global.religion_orthodox = 11 }
				set_variable = { global.religion_coptic = 12 }
			# Islam
				set_variable = { global.religion_sunni = 13 }
				set_variable = { global.religion_shiite = 14 }
				set_variable = { global.religion_ibadi = 15 }
			# Cult
				set_variable = { global.religion_cult_of_personality = 16 }
				set_variable = { global.religion_vodun = 17 }
			# Irreligious
				set_variable = { global.religion_atheist = 18 }
		}